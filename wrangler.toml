name = "japan-quick"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "public"

[browser]
binding = "BROWSER"

[[kv_namespaces]]
binding = "NEWS_CACHE"
id = "d0ff786e95f146e9a0686c3c35654bbb"
preview_id = "17dcdbf7e06e4b88a955ac69631808e7"

[[d1_databases]]
binding = "DB"
database_name = "japan-quick-db"
database_id = "f1417a4f-09de-4ae4-94fe-653ed953c0a6"

[[r2_buckets]]
binding = "ASSETS_BUCKET"
bucket_name = "japan-quick-assets"

[vars]
ADMIN_USERNAME = "admin"
ADMIN_PASSWORD = "gUgcbHCgVesfqQmQn+5GHhHyMFZ8dLfDlFuT37C4fTA"
ASSETS_PUBLIC_URL = "https://japan-quick-assets.nauman.im"

# JWT_SECRET must be set as a Cloudflare secret (not in vars):
# echo "YOUR_SECRET" | wrangler secret put JWT_SECRET

# Workflow bindings
[[workflows]]
name = "news-scraper-workflow"
binding = "NEWS_SCRAPER_WORKFLOW"
class_name = "NewsScraperWorkflow"

[[workflows]]
name = "scheduled-refresh-workflow"
binding = "SCHEDULED_REFRESH_WORKFLOW"
class_name = "ScheduledNewsRefreshWorkflow"

[[workflows]]
name = "article-scraper-workflow"
binding = "ARTICLE_SCRAPER_WORKFLOW"
class_name = "ArticleScraperWorkflow"

[[workflows]]
name = "article-rescrape-workflow"
binding = "ARTICLE_RESCRAPE_WORKFLOW"
class_name = "ArticleRescrapeWorkflow"

[[workflows]]
name = "video-selection-workflow"
binding = "VIDEO_SELECTION_WORKFLOW"
class_name = "VideoSelectionWorkflow"

[[workflows]]
name = "video-render-workflow"
binding = "VIDEO_RENDER_WORKFLOW"
class_name = "VideoRenderWorkflow"

[[workflows]]
name = "script-generation-workflow"
binding = "SCRIPT_GENERATION_WORKFLOW"
class_name = "ScriptGenerationWorkflow"

[[workflows]]
name = "asset-generation-workflow"
binding = "ASSET_GENERATION_WORKFLOW"
class_name = "AssetGenerationWorkflow"

# Durable Objects for sandbox container (SQLite DO required for containers)
[[durable_objects.bindings]]
class_name = "Sandbox"
name = "Sandbox"

[[migrations]]
tag = "v1"
new_classes = ["VideoSandbox"]

[[migrations]]
tag = "v2"
deleted_classes = ["VideoSandbox"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["Sandbox"]

# Containers configuration for ffmpeg video rendering
[[containers]]
class_name = "Sandbox"
image = "./Dockerfile.ffmpeg"
instance_type = "basic"
max_instances = 3

# Cron triggers for scheduled news refresh (hourly)
[triggers]
crons = ["0 * * * *"]
